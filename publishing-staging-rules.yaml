skip-godeps: true
skip-gomod: true
skip-tags: true
rules:
- destination: openshift-apiserver
  branches:
    - name: release-4.2
      source:
        branch: master
        dir: staging/src/github.com/openshift/openshift-apiserver
- destination: oc
  branches:
    - name: master
      source:
        branch: master
        dir: staging/src/github.com/openshift/oc
- destination: template-service-broker
  branches:
    - name: master
      source:
        branch: master
        dir: staging/src/github.com/openshift/template-service-broker
- destination: openshift-controller-manager
  branches:
    - name: master
      source:
        branch: master
        dir: staging/src/github.com/openshift/openshift-controller-manager
- destination: oauth-server
  branches:
    - name: master
      source:
        branch: master
        dir: staging/src/github.com/openshift/oauth-server
- destination: sdn
  branches:
    - name: master
      source:
        branch: master
        dir: staging/src/github.com/openshift/sdn
  smoke-test: |
    # Use this oportunity to restore vendor folder which shall not exist inside staging directly
    glide install --strip-vendor
    git add -f vendor/
    git diff HEAD --exit-code &>/dev/null || git commit -m "Restore vendor"
    # Actual some tests
    make build --warn-undefined-variables
    make test --warn-undefined-variables
