apiVersion: v1
kind: Template
metadata:
  name: failing-dc-mid-template
parameters:
- description: Container image to use
  name: CONTAINER_IMAGE
objects:
- apiVersion: v1
  kind: DeploymentConfig
  metadata:
    name: failing-dc-mid
  spec:
    replicas: 2
    selector:
      name: failing-dc-mid
    strategy:
      type: Recreate
      recreateParams:
        timeoutSeconds: 20
        mid:
          failurePolicy: Abort
          execNewPod:
            containerName: myapp
            command:
            - /bin/echo
            - test mid hook executed
    template:
      metadata:
        labels:
          name: failing-dc-mid
      spec:
        containers:
        - image: "${CONTAINER_IMAGE}"
          name: myapp
          command:
          - /bin/false
          ports:
          - containerPort: 8080
            protocol: TCP
          readinessProbe:
            httpGet:
              path: /healthz
              port: 8080
            timeoutSeconds: 1
    triggers:
    - type: ConfigChange
